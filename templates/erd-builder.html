<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERD Builder - Real-time Preview</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/erd-builder.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/popup.css') }}">
    
    <!-- @hpcc-js/wasm - Modern Graphviz for Web -->
    <script src="https://cdn.jsdelivr.net/npm/@hpcc-js/wasm@2.5.0/dist/graphviz.umd.js"></script>
</head>
<body>
    <div class="container">
        <!-- Left Panel: Form -->
        <div class="form-panel">
            <h2>
                üìä ERD Form
            </h2>

            <!-- ERD Name -->
            <div class="form-group">
                <label>Nama ERD:</label>
                <input type="text" id="erdName" placeholder="Masukkan nama ERD">
            </div>

            <!-- Entities Section -->
            <div class="section-header">
                <h3>Entitas</h3>
                <button class="btn btn-primary" onclick="addEntity()">+ Tambah</button>
            </div>
            <div id="entitiesContainer"></div>

            <!-- Relationships Section -->
            <div class="section-header">
                <h3>Relasi</h3>
                <button class="btn btn-warning" onclick="addRelationship()">+ Tambah</button>
            </div>
            <div id="relationshipsContainer"></div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveERD()">
                    üíæ Simpan
                </button>
            </div>

            <div class="info-box" style="margin-top: 15px;">
                <strong>‚ÑπÔ∏è Preview Real-time:</strong> Menggunakan @hpcc-js/wasm (Graphviz WebAssembly). 
                Preview akan otomatis update saat Anda mengetik!
            </div>
        </div>

        <!-- Right Panel: Preview -->
        <div class="preview-panel">
            <div class="preview-header">
                <h3>üñºÔ∏è Preview ERD</h3>
                <div class="preview-controls">
                    <button class="btn btn-primary" onclick="zoomOut()" title="Zoom Out">
                        üîç‚àí
                    </button>
                    <span id="zoomLevel" style="color: var(--text-primary); font-weight: 600; min-width: 60px; text-align: center; display: inline-block;">100%</span>
                    <button class="btn btn-primary" onclick="zoomIn()" title="Zoom In">
                        üîç+
                    </button>
                    <button class="btn btn-primary" onclick="resetZoom()" title="Reset Zoom">
                        ‚ü≤
                    </button>
                    <button class="btn btn-info" onclick="downloadSVG()">
                        ‚¨áÔ∏è Download SVG
                    </button>
                    <button class="btn btn-info" onclick="downloadPNG()">
                        ‚¨áÔ∏è Download PNG
                    </button>
                </div>
            </div>

            <div class="preview-container" id="previewContainer">
                <div class="empty-state">
                    <h3>Preview akan muncul di sini</h3>
                    <p>Tambahkan entitas dan klik "Update Preview"</p>
                </div>
                
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="spinner"></div>
                    <p style="margin-top: 15px; color: #3b82f6; font-weight: 600;">
                        Generating ERD...
                    </p>
                </div>
            </div>

            <div class="info-box success-box" id="successMessage" style="display: none;">
                <strong>‚úÖ Berhasil!</strong> <span id="successText"></span>
            </div>
        </div>
    </div>

    {%include 'popup.html' %}

    <!-- External JavaScript -->
    <script src="{{ url_for('static', filename='js/erd-builder.js') }}"></script>
    <script src="{{ url_for('static', filename='js/popup.js') }}"></script>
</body>
</html>
